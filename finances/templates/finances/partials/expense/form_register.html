{% load static %}
{% load crispy_forms_tags %}

<!-- ... (cabeçalho e restante do código igual ao anterior) ... -->

<!-- MODAL COM CRISPY FORMS -->
<div id="expenseModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4 backdrop-blur-sm transition-opacity">
    <div class="bg-white rounded-xl z-101 shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-all scale-100">
        
        <!-- Header do Modal -->
        <div class="p-6 pt-20 border-b border-slate-100 flex justify-between items-center sticky top-0 bg-white z-10">
            <h2 class="text-xl font-bold text-slate-800" id="modalTitle">Nova Despesa</h2>
            <button onclick="closeModal()" type="button" class="text-slate-400 hover:text-slate-600">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>
        
        <!-- Form do Django -->
        <form method="post" id="expenseForm" class="p-6" action="{% url 'finances:register_expense' %}" enctype="multipart/form-data">
            <input type="hidden" id="expenseId" name="id">
            {% csrf_token %}
            
            <!-- Aqui o Crispy renderiza todos os campos com o layout Tailwind que definimos no forms.py -->
            {% crispy form %}

            <!-- Botões de Ação (Mantidos manuais para controle do layout do rodapé) -->
            <div class="pt-4 flex justify-end gap-3 border-t border-slate-100 mt-4">
                <button type="button" onclick="closeModal()" class="px-4 py-2 text-slate-700 hover:bg-slate-100 rounded-lg font-medium transition">
                    Cancelar
                </button>
                <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium shadow-sm transition">
                    Salvar Despesa
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ... (scripts) ... -->