<div class="pos-container">
    
    <div class="cart-container">
        <input type="hidden" id="status" value="{{ sale.status }}">
        <h2>Itens da Venda #{{ sale.id }} <span class="status-{{ sale.status }}">{{ sale.status }}</span></h2>
        <div class="cart-header">
            <span class="header-product">Produto</span>
            <span class="header-quantity">Qtd.</span>
            <span class="header-price">Subtotal</span>
            <span class="header-remove"></span>
        </div>
        <ul id="cart-items">
            {% for item in items %}
                {% include "sale/partials/pdv/item.html" %}
            {% empty %}
                <li id='no-items'>Nenhum item na venda</li>
            {% endfor %}
        </ul>
    </div>

    <div class="summary-container">
        <h3>Resumo do Pedido</h3>
        {% if sale.status == 'pendente' %}
            <div class="input-group">
                <label for="quantity">Código de Barras</label>
                <form action="{% url 'sale:sale_add' %}" method="post" id="add-item-form">
                    {% csrf_token %}
                    <div class="input-container">
                        <input type="number" id="quantity" placeholder="qtd" min="1">  
                        <input type="text" id="barcode-input" placeholder="Passe o leitor ou digite o código...">        
                        <button type="submit" style="display: none;">Enviar</button>
                    </div>
                </form>
            </div>
        {% endif %}
        
        <div class="summary-details">
            <form action="{% url 'sale:sale_update' %}" id="summary-form" method="post">
                {% csrf_token %}
                <div class="summary-line discount-line">
                    <label for="client-input">Cliente</label>
                    {% if sale.status == 'pendente' %}
                        <input type="text" id="client-input" placeholder="Nome do cliente" value="{{ sale.client }}">
                    {% else %}
                        <input type="text" id="client-input" placeholder="Nome do cliente" value="{{ sale.client }}" readonly>
                    {% endif %}
                </div>
                <div class="summary-line">
                    <span>Subtotal</span>
                    <span id="subtotal">R$ {{ sale.subtotal }}</span>
                </div>
                <div class="summary-line discount-line">
                    <label for="discount-input">Desconto (R$)</label>
                    {% if sale.status == 'pendente' %}
                        <input type="number" id="discount-input" value="{{ sale.discount }}" min="0" step="0.01">
                    {% else %}
                        <input type="number" id="discount-input" value="{{ sale.discount }}" min="0" step="0.01" readonly>
                    {% endif %}
                </div>
                <div class="summary-line discount-line">
                    <label for="frete-input">Frete (R$)</label>
                    {% if sale.status == 'pendente' %}
                        <input type="number" id="frete-input" value="{{ sale.freight }}" min="0" step="0.01">
                    {% else %}
                        <input type="number" id="frete-input" value="{{ sale.freight }}" min="0" step="0.01" readonly>
                    {% endif %}
                </div>
                <button type="submit" style="display: none;">Enviar</button>
                <div class="summary-line total">
                    <span>Total</span>
                    <span id="total">R$ {{ sale.total_price }}</span>
                </div>
            </form>
        </div>

        <button id="print-btn" class="btn btn-secondary">Imprimir</button>
        {% if sale.status == 'pendente' %}
            <button id="payment-btn" class="btn btn-primary">Finalizar Pagamento</button>
            <form action="{% url 'sale:sale_cancel' sale.id %}" method="post" id="cancel-form">
                {% csrf_token %}
                <button id="cancel-btn" class="btn btn-danger">Cancelar Venda</button>
            </form>
            
        {% endif %}
        
        {% include 'sale/partials/pdv/payment_method.html' %}
    </div>
    {% include 'sale/partials/pdv/search_product.html' %}
</div>
